# version format
version: 4.3.7.{build}

# branches to build
#branches:
#  - 'ci/auto-builder-macdev'
#  except:
#    - gh-pages

# Do not build on tags (GitHub, Bitbucket, GitLab, Gitea)
skip_tags: true

# Skipping commits affecting specific files (GitHub only). More details here: /docs/appveyor-yml
skip_commits:
  files:
    - docs/*
    - '**/*.html'
    - README.md
    - .github/*

# Maximum number of concurrent jobs for the project
max_jobs: 1


#---------------------------------#
#    environment configuration    #
#---------------------------------#

# Build worker image (VM template)
image: Visual Studio 2019

# scripts that are called at very beginning, before repo cloning
init:
  - git config --global core.autocrlf input

# clone directory
clone_folder: C:\projects\software-matrix

# fetch repository as zip archive
shallow_clone: true                 # default is "false"

# set clone depth
clone_depth: 5                      # clone entire repository history if not defined

# this is how to allow failing jobs in the matrix
matrix:
  fast_finish: true     # set this flag to immediately finish build once one of the jobs fails.
  allow_failures:
    - platform: x64
      configuration: Release


# scripts that run after cloning repository
install:
  - ps: |
      Install-PackageProvider -Name NuGet -MinimumVersion 2.8.5.208 -Force
      Install-Module -Name PowerShellGet -Force
      "Git version: $(git.exe --version)"
      "PSVersion:   $($PSVersionTable.PSVersion), build: $($PSVersionTable.BuildVersion), clr version: $($PSVersionTable.ClrVersion)"
      "Host name:   $($Host.Name)"
  - ps: |
      Write-Output "Build manifest files"
      Get-ChildItem -Path .\tests -Filter "test_func-*.ps1" | ForEach-Object { & $_.FullName }
  - ps: |
      Write-Output "Install/Uninstall all applications from manifests"
      .\tests\test-install.ps1


build_script:
  - ps: Write-host "This is powershell!"
#  - ps: ./build.ps1

#test_script:
#  - ps: ./test.ps1

#on_finish:
#  - ps: #$blockRdp = $true; iex ((new-object net.webclient).DownloadString('https://raw.githubusercontent.com/appveyor/ci/master/scripts/enable-rdp.ps1'))